{"version":3,"sources":["../../src/mcp/bootstrap.ts"],"sourcesContent":["#!/usr/bin/env node\n/**\n * MCP Server Bootstrap - installs dependencies before starting server.\n *\n * Uses only Node.js built-ins (no external dependencies required).\n * Self-locates plugin root via import.meta.url (doesn't rely on CLAUDE_PLUGIN_ROOT).\n *\n * Dependency installation strategy:\n * 1. Fast path: node_modules already exists â†’ skip\n * 2. Try prebuilt: Download platform-specific tarball from GitHub release\n * 3. Package manager: Run bun install or npm ci if prebuilt unavailable\n *\n * IMPORTANT: MCP servers must NOT log to stderr - Claude Code treats stderr output\n * as an error and may mark the MCP server as failed. All logging goes to file.\n */\nimport { execSync } from 'node:child_process';\nimport {\n  appendFileSync,\n  chmodSync,\n  createReadStream,\n  createWriteStream,\n  existsSync,\n  mkdirSync,\n  readFileSync,\n  unlinkSync,\n} from 'node:fs';\nimport { get } from 'node:https';\nimport { arch, homedir, platform } from 'node:os';\nimport { dirname, join } from 'node:path';\nimport { fileURLToPath } from 'node:url';\nimport { createGunzip } from 'node:zlib';\n\n// Logging helper - writes to file since MCP servers must NOT use stderr\n// (Claude Code treats stderr as error and may fail the server)\n// JSON format matches pino output for consistency\nconst logDir = join(homedir(), '.bluera', 'bluera-knowledge', 'logs');\nconst logFile = join(logDir, 'app.log');\n\nconst log = (\n  level: 'info' | 'error' | 'debug',\n  msg: string,\n  data?: Record<string, unknown>\n): void => {\n  try {\n    mkdirSync(logDir, { recursive: true });\n    const entry = {\n      time: new Date().toISOString(),\n      level,\n      module: 'bootstrap',\n      msg,\n      ...data,\n    };\n    appendFileSync(logFile, `${JSON.stringify(entry)}\\n`);\n  } catch {\n    // Silently fail - we cannot use stderr for MCP servers\n  }\n};\n\n// Self-locate plugin root from this file's path\n// dist/mcp/bootstrap.js -> plugin root (two directories up)\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\nconst pluginRoot = join(__dirname, '..', '..');\n\n// Get version from package.json\nconst getVersion = (): string => {\n  try {\n    const pkg: unknown = JSON.parse(readFileSync(join(pluginRoot, 'package.json'), 'utf-8'));\n    if (\n      typeof pkg === 'object' &&\n      pkg !== null &&\n      'version' in pkg &&\n      typeof pkg.version === 'string'\n    ) {\n      return `v${pkg.version}`;\n    }\n    return 'unknown';\n  } catch {\n    return 'unknown';\n  }\n};\n\nconst VERSION = getVersion();\nconst MANIFEST_URL = `https://github.com/blueraai/bluera-knowledge/releases/download/${VERSION}/manifest.json`;\n\n/**\n * Fetch JSON from URL with redirect handling.\n * Uses only Node.js built-ins.\n */\nfunction fetchJSON(url: string): Promise<unknown> {\n  return new Promise((resolve, reject) => {\n    const request = (targetUrl: string, redirectCount = 0): void => {\n      if (redirectCount > 5) {\n        reject(new Error('Too many redirects'));\n        return;\n      }\n\n      get(targetUrl, { headers: { 'User-Agent': 'bluera-knowledge' } }, (res) => {\n        // Follow redirects\n        const location = res.headers.location;\n        if (\n          (res.statusCode === 302 || res.statusCode === 301) &&\n          typeof location === 'string' &&\n          location.length > 0\n        ) {\n          request(location, redirectCount + 1);\n          return;\n        }\n        const statusCode = res.statusCode ?? 0;\n        if (statusCode !== 200) {\n          reject(new Error(`HTTP ${String(statusCode)}`));\n          return;\n        }\n        let data = '';\n        res.on('data', (chunk: Buffer) => (data += chunk.toString()));\n        res.on('end', () => {\n          try {\n            resolve(JSON.parse(data));\n          } catch (e) {\n            reject(e instanceof Error ? e : new Error(String(e)));\n          }\n        });\n      }).on('error', reject);\n    };\n    request(url);\n  });\n}\n\n/**\n * Download file from URL to destination path.\n * Uses only Node.js built-ins.\n */\nfunction downloadFile(url: string, destPath: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const request = (targetUrl: string, redirectCount = 0): void => {\n      if (redirectCount > 10) {\n        reject(new Error('Too many redirects'));\n        return;\n      }\n\n      get(targetUrl, { headers: { 'User-Agent': 'bluera-knowledge' } }, (res) => {\n        const location = res.headers.location;\n        if (\n          (res.statusCode === 302 || res.statusCode === 301) &&\n          typeof location === 'string' &&\n          location.length > 0\n        ) {\n          request(location, redirectCount + 1);\n          return;\n        }\n        const statusCode = res.statusCode ?? 0;\n        if (statusCode !== 200) {\n          reject(new Error(`HTTP ${String(statusCode)}`));\n          return;\n        }\n        const file = createWriteStream(destPath);\n        res.pipe(file);\n        file.on('finish', () => {\n          file.close();\n          resolve();\n        });\n        file.on('error', (err) => {\n          file.close();\n          reject(err);\n        });\n      }).on('error', reject);\n    };\n    request(url);\n  });\n}\n\n/**\n * Simple tar parser using Node.js built-ins.\n *\n * TAR format:\n * - 512-byte header blocks\n * - File data follows, padded to 512-byte boundary\n * - Two empty 512-byte blocks at end\n */\nfunction extractTar(tarPath: string, destDir: string): Promise<void> {\n  return new Promise((resolve, reject) => {\n    const gunzip = createGunzip();\n    const input = createReadStream(tarPath);\n\n    let buffer = Buffer.alloc(0);\n    let currentFile: {\n      name: string;\n      size: number;\n      type: string;\n      mode: number;\n    } | null = null;\n    let bytesRemaining = 0;\n    let fileStream: ReturnType<typeof createWriteStream> | null = null;\n\n    const parseHeader = (\n      header: Buffer\n    ): { name: string; size: number; type: string; mode: number } | null => {\n      // Check for empty block (end of archive)\n      if (header.every((b) => b === 0)) {\n        return null;\n      }\n\n      // Parse tar header fields\n      const name = header.subarray(0, 100).toString('utf-8').replace(/\\0/g, '');\n      const mode = parseInt(header.subarray(100, 108).toString('utf-8').trim(), 8);\n      const size = parseInt(header.subarray(124, 136).toString('utf-8').trim(), 8);\n      const typeByte = header[156];\n      const typeFlag = typeByte !== undefined ? String.fromCharCode(typeByte) : '0';\n\n      // Type: '0' or '' = file, '5' = directory, '2' = symlink\n      let type = 'file';\n      if (typeFlag === '5') type = 'directory';\n      else if (typeFlag === '2') type = 'symlink';\n\n      return { name, size, type, mode: isNaN(mode) ? 0o644 : mode };\n    };\n\n    const processChunk = (chunk: Buffer): void => {\n      buffer = Buffer.concat([buffer, chunk]);\n\n      while (buffer.length > 0) {\n        if (currentFile === null) {\n          // Need to read a header\n          if (buffer.length < 512) break;\n\n          const header = buffer.subarray(0, 512);\n          buffer = buffer.subarray(512);\n\n          const parsed = parseHeader(header);\n          if (parsed === null) {\n            // End of archive\n            continue;\n          }\n\n          currentFile = parsed;\n          bytesRemaining = currentFile.size;\n\n          // Skip ./ prefix and handle path\n          let filePath = currentFile.name;\n          if (filePath.startsWith('./')) {\n            filePath = filePath.slice(2);\n          }\n          if (filePath.length === 0 || filePath === '.') {\n            currentFile = null;\n            continue;\n          }\n\n          const fullPath = join(destDir, filePath);\n\n          if (currentFile.type === 'directory') {\n            mkdirSync(fullPath, { recursive: true });\n            currentFile = null;\n          } else if (currentFile.type === 'file' && bytesRemaining > 0) {\n            mkdirSync(dirname(fullPath), { recursive: true });\n            fileStream = createWriteStream(fullPath, {\n              mode: currentFile.mode,\n            });\n          } else if (currentFile.type === 'file' && bytesRemaining === 0) {\n            // Empty file\n            mkdirSync(dirname(fullPath), { recursive: true });\n            createWriteStream(fullPath, { mode: currentFile.mode }).close();\n            currentFile = null;\n          } else {\n            // Skip symlinks and other types\n            currentFile = null;\n          }\n        } else {\n          // Reading file content\n          const toRead = Math.min(bytesRemaining, buffer.length);\n          if (fileStream !== null && toRead > 0) {\n            fileStream.write(buffer.subarray(0, toRead));\n          }\n          buffer = buffer.subarray(toRead);\n          bytesRemaining -= toRead;\n\n          if (bytesRemaining === 0) {\n            if (fileStream !== null) {\n              const stream = fileStream;\n              const file = currentFile;\n              stream.end(() => {\n                // Set executable bit for scripts\n                if ((file.mode & 0o111) !== 0) {\n                  try {\n                    const fullPath = join(\n                      destDir,\n                      file.name.startsWith('./') ? file.name.slice(2) : file.name\n                    );\n                    chmodSync(fullPath, file.mode);\n                  } catch {\n                    // Ignore chmod errors\n                  }\n                }\n              });\n              fileStream = null;\n            }\n            currentFile = null;\n\n            // Skip padding to 512-byte boundary\n            const padding = (512 - (toRead % 512)) % 512;\n            if (buffer.length >= padding) {\n              buffer = buffer.subarray(padding);\n            }\n          }\n        }\n      }\n    };\n\n    input\n      .pipe(gunzip)\n      .on('data', processChunk)\n      .on('end', () => {\n        if (fileStream !== null) {\n          fileStream.end();\n        }\n        resolve();\n      })\n      .on('error', reject);\n  });\n}\n\ninterface PlatformInfo {\n  url: string;\n  sha256: string;\n}\n\ninterface Manifest {\n  version: string;\n  platforms: Record<string, PlatformInfo>;\n}\n\nfunction isManifest(value: unknown): value is Manifest {\n  return (\n    typeof value === 'object' &&\n    value !== null &&\n    'version' in value &&\n    'platforms' in value &&\n    typeof value.platforms === 'object'\n  );\n}\n\n/**\n * Try to download and extract prebuilt binary for current platform.\n * Returns true if successful, false if prebuilt is not available.\n */\nasync function downloadPrebuilt(): Promise<boolean> {\n  const plat = platform(); // 'darwin', 'linux', 'win32'\n  const ar = arch(); // 'arm64', 'x64'\n  const platformKey = `${plat}-${ar}`;\n\n  try {\n    log('info', 'Checking for prebuilt binary', { platformKey, version: VERSION });\n\n    const manifestData = await fetchJSON(MANIFEST_URL);\n    if (!isManifest(manifestData)) {\n      log('info', 'Invalid manifest format');\n      return false;\n    }\n\n    const platformInfo = manifestData.platforms[platformKey];\n    if (platformInfo === undefined) {\n      log('info', 'No prebuilt binary available for platform', { platformKey });\n      return false;\n    }\n\n    log('info', 'Downloading prebuilt binary', { url: platformInfo.url });\n    const tmpDir = join(homedir(), '.bluera', 'tmp');\n    mkdirSync(tmpDir, { recursive: true });\n    const tarPath = join(tmpDir, `bluera-knowledge-${platformKey}.tar.gz`);\n\n    await downloadFile(platformInfo.url, tarPath);\n    log('info', 'Download complete, extracting', { tarPath, destDir: pluginRoot });\n\n    await extractTar(tarPath, pluginRoot);\n\n    // Cleanup temp file\n    try {\n      unlinkSync(tarPath);\n    } catch {\n      // Ignore cleanup errors\n    }\n\n    log('info', 'Prebuilt binary installed successfully');\n    return true;\n  } catch (err) {\n    const message = err instanceof Error ? err.message : String(err);\n    log('debug', 'Prebuilt download failed, will use package manager', {\n      error: message,\n    });\n    return false;\n  }\n}\n\n/**\n * Install dependencies using bun or npm.\n */\nfunction installWithPackageManager(): void {\n  const hasBun = ((): boolean => {\n    try {\n      execSync('which bun', { stdio: 'ignore' });\n      return true;\n    } catch {\n      return false;\n    }\n  })();\n\n  const cmd = hasBun ? 'bun install --frozen-lockfile' : 'npm ci --silent';\n  log('info', 'Installing dependencies with package manager', { hasBun, cmd });\n  execSync(cmd, { cwd: pluginRoot, stdio: 'inherit' });\n  log('info', 'Dependencies installed via package manager');\n}\n\n/**\n * Ensure dependencies are available.\n * Tries prebuilt first, falls back to package manager.\n */\nasync function ensureDependencies(): Promise<void> {\n  // Fast path: already installed\n  if (existsSync(join(pluginRoot, 'node_modules'))) {\n    log('info', 'Dependencies already installed');\n    return;\n  }\n\n  // Try prebuilt binary first (faster, no npm install needed)\n  const prebuiltSuccess = await downloadPrebuilt();\n  if (prebuiltSuccess) {\n    return;\n  }\n\n  // Prebuilt not available, use package manager instead\n  installWithPackageManager();\n}\n\n// Main entry point\nlog('info', 'Bootstrap starting', { pluginRoot, version: VERSION });\n\nawait ensureDependencies();\n\n// Now that dependencies are installed, import and run the server\n// Dynamic import required because @modelcontextprotocol/sdk wouldn't be available before install\nlog('info', 'Loading server module');\nconst { runMCPServer } = await import('./server.js');\n\nconst projectRoot = process.env['PROJECT_ROOT'];\nif (projectRoot === undefined) {\n  throw new Error('PROJECT_ROOT environment variable is required');\n}\n\nlog('info', 'Starting MCP server', {\n  projectRoot,\n  dataDir: process.env['DATA_DIR'],\n});\n\nawait runMCPServer({\n  dataDir: process.env['DATA_DIR'],\n  config: process.env['CONFIG_PATH'],\n  projectRoot,\n});\n"],"mappings":"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","names":[]}